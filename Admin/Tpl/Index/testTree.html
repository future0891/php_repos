<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<title>测试</title>
</head>
<link rel="stylesheet" href="__PUBLIC__/ztree/css/zTreeStyle/zTreeStyle.css" type="text/css">
<script type="text/javascript" src="__PUBLIC__/Js/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.core-3.5.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.exedit-3.5.js"></script>
<script type="text/javascript">
    $(function(){

        var MoveTest = {
            errorMsg: "放错了...请选择正确的类别！",
            curTarget: null,
            curTmpTarget: null,
            noSel: function() {
                try {
                    window.getSelection ? window.getSelection().removeAllRanges() : document.selection.empty();
                } catch(e){}
            },
            dragTree2Dom: function(treeId, treeNodes) {
                return !treeNodes[0].isParent;
            },
            prevTree: function(treeId, treeNodes, targetNode) {
                return !targetNode.isParent && targetNode.parentTId == treeNodes[0].parentTId;
            },
            nextTree: function(treeId, treeNodes, targetNode) {
                return !targetNode.isParent && targetNode.parentTId == treeNodes[0].parentTId;
            },
            innerTree: function(treeId, treeNodes, targetNode) {
                return targetNode!=null && targetNode.isParent && targetNode.tId == treeNodes[0].parentTId;
            },
            dropTree2Dom: function(e, treeId, treeNodes, targetNode, moveType) {
                var domId = "dom_" + treeNodes[0].getParentNode().id;
                if (moveType == null && (domId == e.target.id || $(e.target).parents("#" + domId).length > 0)) {
                    var zTree = $.fn.zTree.getZTreeObj("treeDemo");
                    zTree.removeNode(treeNodes[0]);

                    var newDom = $("span[domId=" + treeNodes[0].id + "]");
                    if (newDom.length > 0) {
                        newDom.removeClass("domBtn_Disabled");
                        newDom.addClass("domBtn");
                    } else {
                        $("#" + domId).append("<span class='domBtn' domId='" + treeNodes[0].id + "'>" + treeNodes[0].name + "</span>");
                    }
                    MoveTest.updateType();
                } else if ( $(e.target).parents(".domBtnDiv").length > 0) {
                    alert(MoveTest.errorMsg);
                }
            },
        };

        var setting = {
            edit: {
                enable: true,
                showRemoveBtn: false,
                showRenameBtn: false,
                drag: {
                    prev: MoveTest.prevTree,
                    next: MoveTest.nextTree,
                    inner: MoveTest.innerTree
                }
            },
            data: {
                keep: {
                    parent: true,
                    leaf: true
                },
                simpleData: {
                    enable: true
                }
            },
            callback: {
                beforeDrag: MoveTest.dragTree2Dom,
                onDrop: MoveTest.dropTree2Dom,
                onMouseUp: MoveTest.dom2Tree
            },
            view: {
                selectedMulti: false
            }
        };
        
            var zNodes =[
            { id:1, pId:0, name:"植物", isParent: true, open:true},
            { id:2, pId:0, name:"动物", isParent: true, open:true},
            { id:20, pId:2, name:"大象"},
            { id:29, pId:2, name:"鲨鱼"},
            { id:10, pId:1, name:"大白菜"},
            { id:19, pId:1, name:"西红柿"}
        ];
        
      $.fn.zTree.init($("#treeDemo"), setting, zNodes);   
    });
</script>
<body>
	<ul id="treeDemo" class="ztree"></ul>
	<div style="border:1px dashed #FF0000; background:#ffff00"><span>请放到篮子里</span></div>
</body>
</html>