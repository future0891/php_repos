<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>showChannel</title>
         <link rel="stylesheet" type="text/css" href="__PUBLIC__/ztree/css/zTreeStyle/zTreeStyle.css" />
         <link rel="stylesheet" type="text/css" href="__PUBLIC__/Css/table.css">
         <link rel="stylesheet" type="text/css" href="__PUBLIC__/uploadify/uploadify.css" />
         <link rel="stylesheet" type="text/css" href="__PUBLIC__/easyui/themes/icon.css">
        <script type="text/javascript" src="__PUBLIC__/Js/jquery.min.js"></script>
        <script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.core-3.5.min.js"></script>
        <script type="text/javascript" src="__PUBLIC__/ztree/js/jquery.ztree.excheck-3.5.js"></script>
        <script type="text/javascript" src="__PUBLIC__/easyui/easyloader.js"></script>
        <script type="text/javascript" src="__PUBLIC__/uploadify/jquery.uploadify.js"></script>
        <script type="text/javascript" src="__PUBLIC__/Js/formTree.js"></script>
        <script type="text/javascript">
        var t;
        $(function(){
            easyloader.theme = "bootstrap";
            using(['panel' ,'layout'] , function(){
                $("#p_wrap").panel({title:"面板"});
                $("#p_layout").layout({fit:true});
            });

            $("#ss").on("click" , function(){
                $("#leftTree").panel("refresh");
            });

              var settings = {
                data: {
                    simpleData: {
                        enable: true,
                        idKey: "id",
                        pIdKey: "pid",
                        rootPId: -1
                    }
                },
               callback: {
                    onClick:showframe,
               }
                
            };
            
            
            function showframe(event , treeId , treeNode){
                $("#p_content").panel("refresh" , "__URL__/showOptList/cid/"+treeNode.id);
            }
            var channel = {$channel};
            t = $.fn.zTree.init($("#tree") , settings , channel);
            
                   
           $("#p_content").ajaxSuccess(function(){
               if(!$.isEmptyObject('.updatebtn') ) {
                   $(".delbtn").on("click" ,function(){
                   if(!confirm("该操作不可逆,是否删除!")) {
                       return false;
                   }
               });                   

                   $(".updatebtn").on("click",function(){
                       
                       $("#p_content").panel("refresh" , "__URL__/update/pid/"+$(this).attr("title"));
                   });    
               }
               
               if(!$.isEmptyObject('#channel') ){
                   $("#treeDemo").formTree({zNodes:channel}).expandAll(true);
                    $("#channel").on("click",showMenu);
               }
               
              
           });
           var node;
           $("#p_content").ajaxSuccess(function() {
               $("#pic").uploadify({
                    'auto':false,
                    'buttonText' : '请选择文件',
                    'swf': '__PUBLIC__/uploadify/uploadify.swf',
                    'uploader' : '__URL__/getImage',
                    'button_image_url':'__APP__',
                    'fileTypeExts' : '*.gif; *.jpg; *.png',
                    'onUploadSuccess' : function(file, data, response) {
                        var resp = "<tr><td><img src=__PUBLIC__/Upload/Thumb/s_"+data + "  alt='无图片' /></td>";
                        resp +="<td>是否推荐<input type='checkbox'  name='recommend' value='1'/><input type='hidden' name='path[]' value ='" +data+"' ></td>";
                        resp +="<td><a href='#' class='delbtn' >删除</a></td></tr>";

                        $('#u_pic').append(resp);
                        $(".delbtn").linkbutton({
                            iconCls: 'icon-cancel'
                        }).click(function(){
                            var col = this;
                            $.post('__URL__/delPic' , {'pic': data} ,function(r){
                                $(col).parents("tr").remove();
                            });
                        });
                    }
                });    
                
                var pro_id = $("#cid").val(); 
                var tree = $.fn.zTree.getZTreeObj("treeDemo");
                node = tree.getNodeByParam('id' ,pro_id , null);
                $("#channel").attr("value",node['name']);
               
                
                using(['linkbutton'] ,function(){
                        $(".pic_delbtn").linkbutton({
                            iconCls: 'icon-cancel'
                        }).click(function(){
                            var col = this;
                             if(!confirm("该操作不可逆,是否确认删除!")) {
                                return false;
                            }
                            $.post('__URL__/delPic' , {'pic': data} ,function(r){
                                $(col).parents("tr").remove();
                            });

                        });                    
                });   
                         
           });
           

            
        });

        </script>      
<style type="text/css">
#file_wrap {
    display:block;
    width:500px;
    height:200px;
}
</style>
    </head>
    <body>
     <div  id = "p_wrap" style="width:900px;height:700px;padding:10px;">
        <div id="p_layout" >
            <div data-options="region:'west',split:true" style="width:170px;padding:10px" id ="leftTree">
                <ul id="tree" class="ztree"></ul>
            </div>
            <div data-options="region:'center'" style="padding:10px" id="p_content">
                选择栏目
            </div>
        </div>
    </div>
    <div id="menuContent" class="menuContent" style="display:none; position: absolute;background-color: #5FC6DA;">
        <ul id="treeDemo" class="ztree" style="margin-top:0; width:160px;"></ul>
    </div>    
    
    </body>
</html>

